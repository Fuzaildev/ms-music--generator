/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={34799:function(e,t,n){"use strict";e.exports=n.p+"454945697dbdb60cd5a3.js"},58394:function(e,t,n){"use strict";e.exports=n.p+"9e98cea37a57a8cdfb1c.css"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.m=e,n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=o[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b=document.baseURI||self.location.href,function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){"use strict";t=function(){return o};var n,o={},r=Object.prototype,a=r.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(n){d=function(e,t,n){return e[t]=n}}function g(e,t,n,o){var r=t&&t.prototype instanceof b?t:b,a=Object.create(r.prototype),i=new F(o||[]);return s(a,"_invoke",{value:T(e,n,i)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}o.wrap=g;var m="suspendedStart",f="suspendedYield",h="executing",y="completed",v={};function b(){}function x(){}function k(){}var w={};d(w,c,(function(){return this}));var P=Object.getPrototypeOf,I=P&&P(P(U([])));I&&I!==r&&a.call(I,c)&&(w=I);var E=k.prototype=b.prototype=Object.create(w);function S(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function C(t,n){function o(r,s,i,c){var l=p(t[r],t,s);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==e(d)&&a.call(d,"__await")?n.resolve(d.__await).then((function(e){o("next",e,i,c)}),(function(e){o("throw",e,i,c)})):n.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return o("throw",e,i,c)}))}c(l.arg)}var r;s(this,"_invoke",{value:function(e,t){function a(){return new n((function(n,r){o(e,t,n,r)}))}return r=r?r.then(a,a):a()}})}function T(e,t,o){var r=m;return function(a,s){if(r===h)throw Error("Generator is already running");if(r===y){if("throw"===a)throw s;return{value:n,done:!0}}for(o.method=a,o.arg=s;;){var i=o.delegate;if(i){var c=A(i,o);if(c){if(c===v)continue;return c}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(r===m)throw r=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);r=h;var l=p(e,t,o);if("normal"===l.type){if(r=o.done?y:f,l.arg===v)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(r=y,o.method="throw",o.arg=l.arg)}}}function A(e,t){var o=t.method,r=e.iterator[o];if(r===n)return t.delegate=null,"throw"===o&&e.iterator.return&&(t.method="return",t.arg=n,A(e,t),"throw"===t.method)||"return"!==o&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+o+"' method")),v;var a=p(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,v;var s=a.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,v):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function F(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function U(t){if(t||""===t){var o=t[c];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function e(){for(;++r<t.length;)if(a.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=n,e.done=!0,e};return s.next=s}}throw new TypeError(e(t)+" is not iterable")}return x.prototype=k,s(E,"constructor",{value:k,configurable:!0}),s(k,"constructor",{value:x,configurable:!0}),x.displayName=d(k,u,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,d(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},o.awrap=function(e){return{__await:e}},S(C.prototype),d(C.prototype,l,(function(){return this})),o.AsyncIterator=C,o.async=function(e,t,n,r,a){void 0===a&&(a=Promise);var s=new C(g(e,t,n,r),a);return o.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},S(E),d(E,u,"Generator"),d(E,c,(function(){return this})),d(E,"toString",(function(){return"[object Generator]"})),o.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},o.values=U,F.prototype={constructor:F,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(B),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(o,r){return i.type="throw",i.arg=e,t.next=o,r&&(t.method="next",t.arg=n),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],i=s.completion;if("root"===s.tryLoc)return o("end");if(s.tryLoc<=this.prev){var c=a.call(s,"catchLoc"),l=a.call(s,"finallyLoc");if(c&&l){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return o(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&a.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var s=r?r.completion:{};return s.type=e,s.arg=t,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;B(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,o){return this.delegate={iterator:U(e),resultName:t,nextLoc:o},"next"===this.method&&(this.arg=n),v}},o}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,s,i=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=a.call(n)).done)&&(i.push(o.value),i.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw r}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t,n,o,r,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(o,r)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var s=e.apply(t,n);function i(e){r(s,o,a,i,c,"next",e)}function c(e){r(s,o,a,i,c,"throw",e)}i(void 0)}))}}var s=null,i=null,c=null,l=!1;function u(){return d.apply(this,arguments)}function d(){return(d=a(t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("🖼️ getImageFromDocument called"),e.prev=1,A("Getting image from document...",!1),n=Office.context.host,console.log("🏢 Office host type:",n),e.t0=n,e.next=e.t0===Office.HostType.Word?8:e.t0===Office.HostType.Excel?12:e.t0===Office.HostType.PowerPoint?16:20;break;case 8:return console.log("📝 Calling getImageFromWord"),e.next=11,g();case 11:return e.abrupt("break",23);case 12:return console.log("📊 Calling getImageFromExcel"),e.next=15,h();case 15:return e.abrupt("break",23);case 16:return console.log("📽️ Calling getImageFromPowerPoint"),e.next=19,v();case 19:return e.abrupt("break",23);case 20:console.error("❌ Unsupported Office application:",n),L(),te("Image capture is not supported in this Office application.");case 23:e.next=30;break;case 25:e.prev=25,e.t1=e.catch(1),L(),console.error("❌ Error getting image from document:",e.t1),te("Error getting image from document. Please try again.");case 30:case"end":return e.stop()}}),e,null,[[1,25]])})))).apply(this,arguments)}function g(){return p.apply(this,arguments)}function p(){return p=a(t().mark((function n(){return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("📝 getImageFromWord started"),n.prev=1,n.next=4,Word.run(function(){var n=a(t().mark((function n(o){var r,s,i,c,l,u,d,g,p,f,h,y,v;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("🔄 Word.run context established"),r=o.document.getSelection(),console.log("📍 Selection range obtained"),s=r.inlinePictures,o.load(s,"items"),console.log("🖼️ Loading inline pictures from selection"),n.next=8,o.sync();case 8:if(console.log("✅ Context sync completed, inline pictures loaded"),console.log("📊 Number of inline pictures found:",s.items.length),!(s.items.length>0)){n.next=52;break}return console.log("✅ Found inline images in selection, processing first image"),i=s.items[0],console.log("🔄 Loading multiple properties for inline image"),o.load(i,["base64ImageSrc","width","height","altTextTitle","altTextDescription"]),n.next=17,o.sync();case 17:if(console.log("✅ Inline image properties loaded"),console.log("📊 Image properties:",{base64ImageSrc:i.base64ImageSrc?"".concat(i.base64ImageSrc.length," chars"):"null",width:i.width,height:i.height,altTextTitle:i.altTextTitle,altTextDescription:i.altTextDescription}),!i.base64ImageSrc){n.next=26;break}return console.log("🎯 Using base64ImageSrc data"),n.next=23,m(i.base64ImageSrc,"word-inline-image.png");case 23:return n.abrupt("return");case 26:if(console.error("❌ No base64ImageSrc data available for inline image"),console.log("🔄 Trying alternative base64 extraction method..."),n.prev=28,"function"!=typeof i.getBase64ImageSrc){n.next=41;break}return console.log("🔄 Using getBase64ImageSrc method"),c=i.getBase64ImageSrc(),n.next=34,o.sync();case 34:if(!c||!c.value){n.next=39;break}return console.log("✅ Alternative method successful:",c.value.length,"chars"),n.next=38,m(c.value,"word-inline-image-alt.png");case 38:return n.abrupt("return");case 39:n.next=42;break;case 41:console.log("⚠️ getBase64ImageSrc method not available");case 42:return console.log("🔄 Trying Office.context.document.getSelectedDataAsync fallback"),Office.context.document.getSelectedDataAsync(Office.CoercionType.Image,{imageLeft:0,imageTop:0,imageWidth:500,imageHeight:500},function(){var n=a(t().mark((function n(o){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("📋 getSelectedDataAsync result:",{status:o.status,hasValue:!!o.value,valueType:e(o.value),valueLength:o.value?o.value.length:0}),o.status!==Office.AsyncResultStatus.Succeeded||!o.value){t.next=14;break}if(t.prev=2,"string"!=typeof o.value){t.next=9;break}return r=o.value.startsWith("data:image")?o.value.split(",")[1]:o.value,console.log("✅ Fallback method successful:",r.length,"chars"),t.next=8,m(r,"word-fallback-image.png");case 8:return t.abrupt("return");case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.error("❌ Fallback processing error:",t.t0);case 14:console.error("❌ All image extraction methods failed"),L(),te("Unable to extract image data. The image format may not be supported or there may be a Word API limitation.");case 17:case"end":return t.stop()}}),n,null,[[2,11]])})));return function(e){return n.apply(this,arguments)}}()),n.abrupt("return");case 47:n.prev=47,n.t0=n.catch(28),console.error("❌ Alternative extraction error:",n.t0);case 50:n.next=159;break;case 52:return console.warn("⚠️ No inline pictures found in selection"),console.log("🔄 Trying to find floating images/shapes in selection"),n.prev=54,l=r.paragraphs.getFirst(),o.load(l),n.next=59,o.sync();case 59:return u=o.document.body.inlinePictures,o.load(u,"items"),n.next=63,o.sync();case 63:if(console.log("📊 Total inline pictures in document:",u.items.length),!(u.items.length>0)){n.next=150;break}return console.log("💡 Found images in document. Please try one of these methods:"),console.log("   1. Click directly on an image to select it"),console.log("   2. Place your cursor right next to an image"),console.log("   3. Select text that includes an image"),console.log("🔄 Attempting to automatically extract the first available image..."),n.prev=70,d=u.items[0],o.load(d,"base64ImageSrc"),n.next=75,o.sync();case 75:if(console.log("✅ First image loaded, checking base64 data"),console.log("📏 Base64 data length:",d.base64ImageSrc?d.base64ImageSrc.length:"null"),!d.base64ImageSrc){n.next=84;break}return console.log("🎯 Successfully extracted first image automatically"),n.next=81,m(d.base64ImageSrc,"word-auto-extracted-image.png");case 81:return n.abrupt("return");case 84:console.warn("⚠️ First image has no base64ImageSrc data");case 85:n.next=90;break;case 87:n.prev=87,n.t1=n.catch(70),console.log("⚠️ Auto-extraction failed:",n.t1.message);case 90:return console.log("🔄 Trying to select the first image programmatically..."),n.prev=91,(g=u.items[0]).select(),n.next=96,o.sync();case 96:return console.log("✅ Image selected programmatically"),o.load(g,"base64ImageSrc"),n.next=100,o.sync();case 100:if(console.log("📏 Base64 data length after selection:",g.base64ImageSrc?g.base64ImageSrc.length:"null"),!g.base64ImageSrc){n.next=108;break}return console.log("🎯 Successfully extracted image after programmatic selection"),n.next=105,m(g.base64ImageSrc,"word-selected-image.png");case 105:return n.abrupt("return");case 108:console.warn("⚠️ Still no base64ImageSrc data after selection");case 109:n.next=114;break;case 111:n.prev=111,n.t2=n.catch(91),console.log("⚠️ Programmatic selection failed:",n.t2.message);case 114:return console.log("🔄 Trying to access image through containing paragraph..."),n.prev=115,p=o.document.body.paragraphs,o.load(p,"items"),n.next=120,o.sync();case 120:f=0;case 121:if(!(f<p.items.length)){n.next=142;break}return h=p.items[f],y=h.inlinePictures,o.load(y,"items"),n.next=127,o.sync();case 127:if(!(y.items.length>0)){n.next=139;break}return console.log("📄 Found ".concat(y.items.length," image(s) in paragraph ").concat(f+1)),v=y.items[0],o.load(v,"base64ImageSrc"),n.next=133,o.sync();case 133:if(console.log("📏 Paragraph image base64 length:",v.base64ImageSrc?v.base64ImageSrc.length:"null"),!v.base64ImageSrc){n.next=139;break}return console.log("🎯 Successfully extracted image from paragraph"),n.next=138,m(v.base64ImageSrc,"word-paragraph-image.png");case 138:return n.abrupt("return");case 139:f++,n.next=121;break;case 142:n.next=147;break;case 144:n.prev=144,n.t3=n.catch(115),console.log("⚠️ Paragraph approach failed:",n.t3.message);case 147:return L(),te("No image found in your selection. Please click directly on an image in the document, then try again."),n.abrupt("return");case 150:n.next=155;break;case 152:n.prev=152,n.t4=n.catch(54),console.log("⚠️ Could not check for shapes:",n.t4.message);case 155:return console.log("❌ No images found in selection or document"),L(),te("No images found. Please:\n1. Insert an image into your Word document\n2. Click on the image to select it\n3. Then click 'Get Image from Document'"),n.abrupt("return");case 159:L(),te("Could not extract image data. Please try selecting the image again.");case 161:case"end":return n.stop()}}),n,null,[[28,47],[54,152],[70,87],[91,111],[115,144]])})));return function(e){return n.apply(this,arguments)}}());case 4:n.next=11;break;case 6:n.prev=6,n.t0=n.catch(1),L(),console.error("❌ Error in getImageFromWord:",{error:n.t0,message:n.t0.message,stack:n.t0.stack}),te("Failed to get image from Word. Please select an image and try again.");case 11:case"end":return n.stop()}}),n,null,[[1,6]])}))),p.apply(this,arguments)}function m(e,t){return f.apply(this,arguments)}function f(){return(f=a(t().mark((function e(n,o){var r,a,s,u,d,g,p,m,f,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("🎯 Processing Word image data"),console.log("📏 Base64 data length:",n.length);try{for(r=n,a=atob(r),s=[],console.log("🔄 Converting base64 to byte arrays"),u=0;u<a.length;u+=512){for(d=a.slice(u,u+512),g=new Array(d.length),p=0;p<d.length;p++)g[p]=d.charCodeAt(p);m=new Uint8Array(g),s.push(m)}f=new Blob(s,{type:"image/png"}),h=new File([f],o,{type:"image/png"}),console.log("✅ File object created:",{name:h.name,size:h.size,type:h.type}),i=h,c=null,l=!0,console.log("🔄 Updating global variables:",{uploadedFile:!!i,capturedImageData:!!c,isImageEditingMode:l}),console.log("🎨 Calling updateUploadSectionWithFile"),w(h,"data:image/png;base64,".concat(r)),L(),ne("Image captured from Word document successfully!"),console.log("🎉 Word image processing completed successfully")}catch(e){console.error("❌ Error processing Word image:",e),L(),te("Failed to process the captured image. Please try again.")}case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return y.apply(this,arguments)}function y(){return y=a(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Excel.run(function(){var e=a(t().mark((function e(n){var o,r,a,s,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.workbook.worksheets.getActiveWorksheet(),r=o.shapes,n.load(r,"items"),e.next=5,n.sync();case 5:if(!(r.items.length>0)){e.next=38;break}a=null,s=0;case 8:if(!(s<r.items.length)){e.next=19;break}return i=r.items[s],n.load(i,"type"),e.next=13,n.sync();case 13:if("Image"!==i.type){e.next=16;break}return a=i,e.abrupt("break",19);case 16:s++,e.next=8;break;case 19:if(!a){e.next=34;break}return e.prev=20,n.load(a,["width","height","left","top"]),e.next=24,n.sync();case 24:L(),te("Excel doesn't support direct image extraction. Please save the image separately and upload it using the upload button."),e.next=32;break;case 28:e.prev=28,e.t0=e.catch(20),L(),te("Unable to extract image from Excel. Please save the image separately and upload it using the upload button.");case 32:e.next=36;break;case 34:L(),te("No images found in the Excel worksheet.");case 36:e.next=40;break;case 38:L(),te("No shapes found in the Excel worksheet.");case 40:case"end":return e.stop()}}),e,null,[[20,28]])})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=10;break;case 5:e.prev=5,e.t0=e.catch(0),L(),console.error("Error getting image from Excel:",e.t0),te("Failed to get image from Excel. Please try uploading the image using the upload button.");case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),y.apply(this,arguments)}function v(){return b.apply(this,arguments)}function b(){return b=a(t().mark((function n(){return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("📽️ getImageFromPowerPoint started"),n.prev=1,"undefined"==typeof PowerPoint||!PowerPoint.run){n.next=23;break}return console.log("🔄 Using PowerPoint API approach"),n.prev=4,n.next=7,PowerPoint.run(function(){var e=a(t().mark((function e(n){var o,r,a,s,i,c,l,u,d;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("🔄 PowerPoint.run context established"),o=n.presentation.getSelectedShapes(),n.load(o,"items"),console.log("📍 Loading selected shapes"),e.next=6,n.sync();case 6:if(console.log("✅ Context sync completed"),console.log("📊 Number of selected shapes:",o.items.length),0!==o.items.length){e.next=54;break}return console.log("🔍 No shapes selected, checking current slide for available images"),e.prev=10,r=n.presentation.slides,n.load(r,"items"),e.next=15,n.sync();case 15:if(0!==r.items.length){e.next=17;break}throw new Error("No slides found in the presentation.");case 17:return a=r.items[0],s=a.shapes,n.load(s,"items"),e.next=22,n.sync();case 22:console.log("📊 Total shapes on slide:",s.items.length),i=0,c=[],l=0;case 26:if(!(l<s.items.length)){e.next=37;break}return u=s.items[l],n.load(u,["type","name","id"]),e.next=31,n.sync();case 31:console.log("Shape ".concat(l+1,":"),{type:u.type,name:u.name,id:u.id}),(u.type===PowerPoint.ShapeType.picture||"Image"===u.type||"Picture"===u.type||"image"===String(u.type).toLowerCase()||"picture"===String(u.type).toLowerCase())&&(i++,c.push({index:l+1,name:u.name,id:u.id}));case 34:l++,e.next=26;break;case 37:if(console.log("📊 Number of images found on slide:",i),console.log("🖼️ Image shapes:",c),!(i>0)){e.next=45;break}throw c.map((function(e){return"• Image ".concat(e.index,": ").concat(e.name||"Unnamed")})).join("\n"),console.log("💡 Found images but none selected. Trying fallback method before showing guidance."),new Error("FALLBACK_NEEDED_NO_SELECTION");case 45:throw new Error("No images found on this slide. Please insert an image first, then select it and try again.");case 46:e.next=54;break;case 48:if(e.prev=48,e.t0=e.catch(10),console.log("⚠️ Error checking slide content:",e.t0.message),"FALLBACK_NEEDED_NO_SELECTION"!==e.t0.message){e.next=53;break}throw e.t0;case 53:throw new Error("No shapes selected. Please click directly on an image in your PowerPoint slide to select it, then try again.");case 54:return d=o.items[0],n.load(d,["type","name","id"]),console.log("🔄 Loading shape properties"),e.next=59,n.sync();case 59:if(console.log("✅ Shape properties loaded:",{type:d.type,name:d.name,id:d.id}),console.log("🔍 Checking shape type:",{shapeType:d.type,shapeTypeString:String(d.type),expectedEnum:PowerPoint.ShapeType.picture,expectedEnumString:String(PowerPoint.ShapeType.picture)}),d.type===PowerPoint.ShapeType.picture||"Image"===d.type||"Picture"===d.type||"image"===String(d.type).toLowerCase()||"picture"===String(d.type).toLowerCase()){e.next=64;break}throw new Error('Selected shape "'.concat(d.name||"Unnamed",'" is not an image (type: ').concat(d.type,"). Please select an image instead."));case 64:throw console.log("🖼️ Shape is a picture, but PowerPoint Add-in API doesn't support direct image extraction"),console.log("🔄 Attempting fallback method using Office.context.document.getSelectedDataAsync"),new Error("FALLBACK_NEEDED");case 67:case"end":return e.stop()}}),e,null,[[10,48]])})));return function(t){return e.apply(this,arguments)}}());case 7:return n.abrupt("return");case 10:if(n.prev=10,n.t0=n.catch(4),console.log("⚠️ PowerPoint API approach result:",n.t0.message),"FALLBACK_NEEDED"!==n.t0.message&&"FALLBACK_NEEDED_NO_SELECTION"!==n.t0.message){n.next=18;break}return console.log("🔄 Trying Office.context.document.getSelectedDataAsync fallback for PowerPoint"),n.abrupt("return",new Promise((function(o,r){Office.context.document.getSelectedDataAsync(Office.CoercionType.Image,{imageLeft:0,imageTop:0,imageWidth:500,imageHeight:500},function(){var s=a(t().mark((function a(s){var i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("📋 PowerPoint getSelectedDataAsync result:",{status:s.status,hasValue:!!s.value,valueType:e(s.value),valueLength:s.value?s.value.length:0,error:s.error}),s.status!==Office.AsyncResultStatus.Succeeded||!s.value){t.next=17;break}if(t.prev=2,"string"!=typeof s.value){t.next=10;break}return i=s.value.startsWith("data:image")?s.value.split(",")[1]:s.value,console.log("✅ PowerPoint fallback method successful:",i.length,"chars"),t.next=8,x(i,"powerpoint-fallback-image.png");case 8:return o(),t.abrupt("return");case 10:t.next=17;break;case 12:return t.prev=12,t.t0=t.catch(2),console.error("❌ PowerPoint fallback processing error:",t.t0),r(t.t0),t.abrupt("return");case 17:console.error("❌ PowerPoint fallback method also failed"),L(),"FALLBACK_NEEDED_NO_SELECTION"===n.t0.message?te('Found image(s) on this slide but none are selected.\n\nPlease click directly on an image to select it, then try "Get Image from Document" again.\n\nAlternative solutions if selection doesn\'t work:\n1. **Use the Upload Button**: Right-click the image → "Save as Picture" → then upload using the upload button above\n2. **Copy & Paste**: Copy the image, paste into an image editor, save, then upload'):te('PowerPoint Add-in API Limitation: Direct image extraction is not supported by Microsoft\'s Office Add-in platform.\n\nAlternative solutions:\n1. **Use the Upload Button**: Right-click the image in PowerPoint → "Save as Picture" → then upload using the upload button above\n2. **Copy & Paste**: Copy the image in PowerPoint, paste into an image editor, save, then upload\n3. **Extract from File**: Save PowerPoint as .zip, navigate to ppt/media folder to find original images\n\nThis is a known limitation of Office Add-ins, not a bug in this tool.'),r(new Error("PowerPoint image extraction failed"));case 21:case"end":return t.stop()}}),a,null,[[2,12]])})));return function(e){return s.apply(this,arguments)}}())})));case 18:return L(),te(n.t0.message),n.abrupt("return");case 21:n.next=27;break;case 23:return console.log("⚠️ PowerPoint API not available"),L(),te("PowerPoint API is not available. Please ensure you're using a supported version of PowerPoint and try again."),n.abrupt("return");case 27:n.next=36;break;case 29:n.prev=29,n.t1=n.catch(1),L(),console.error("❌ Error in getImageFromPowerPoint:",{error:n.t1,message:n.t1.message,stack:n.t1.stack}),te(n.t1.message.includes("Please click directly on")||n.t1.message.includes("No images found")||n.t1.message.includes("Please select an image")||n.t1.message.includes("not an image")?n.t1.message:n.t1.message.includes("No base64 data")||n.t1.message.includes("unsupported format")?n.t1.message+"\n\nTry saving the image separately and using the upload button instead.":n.t1.message.includes("PowerPoint API is not available")?n.t1.message:n.t1.message.includes("PowerPoint Add-in API does not support")||n.t1.message.includes("PowerPoint Add-in API limitation")?'PowerPoint Add-in API Limitation: Direct image extraction is not supported by Microsoft\'s Office Add-in platform.\n\nAlternative solutions:\n1. **Use the Upload Button**: Right-click the image in PowerPoint → "Save as Picture" → then upload using the upload button above\n2. **Copy & Paste**: Copy the image in PowerPoint, paste into an image editor, save, then upload\n3. **Extract from File**: Save PowerPoint as .zip, navigate to ppt/media folder to find original images\n\nThis is a known limitation of Office Add-ins, not a bug in this tool.':"Failed to extract image from PowerPoint. Please try:\n\n1. Click directly on an image to select it\n2. Make sure the image is not grouped with other objects\n3. Try using the upload button as an alternative");case 36:case"end":return n.stop()}}),n,null,[[1,29],[4,10]])}))),b.apply(this,arguments)}function x(e,t){return k.apply(this,arguments)}function k(){return(k=a(t().mark((function e(n,o){var r,a,s,u,d,g,p,m,f;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("🎯 Processing PowerPoint image data"),console.log("📏 Base64 data length:",n.length);try{for(r=atob(n),a=[],console.log("🔄 Converting base64 to byte arrays"),s=0;s<r.length;s+=512){for(u=r.slice(s,s+512),d=new Array(u.length),g=0;g<u.length;g++)d[g]=u.charCodeAt(g);p=new Uint8Array(d),a.push(p)}m=new Blob(a,{type:"image/png"}),f=new File([m],o,{type:"image/png"}),console.log("✅ PowerPoint File object created:",{name:f.name,size:f.size,type:f.type}),i=f,c=null,l=!0,console.log("🔄 Updating global variables for PowerPoint:",{uploadedFile:!!i,capturedImageData:!!c,isImageEditingMode:l}),console.log("🎨 Calling updateUploadSectionWithFile for PowerPoint"),w(f,"data:image/png;base64,".concat(n)),L(),ne("Image captured from PowerPoint successfully!"),console.log("🎉 PowerPoint image processing completed successfully")}catch(e){console.error("❌ Error processing PowerPoint image:",e),L(),te("Failed to process the captured image. Please try again.")}case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t){var n;console.log("🎨 Updating upload section with captured file:",{fileName:e.name,fileSize:e.size,fileType:e.type,hasImageDataUrl:!!t});var o=document.getElementById("uploadArea"),r=o.querySelector(".upload-content"),a=document.getElementById("clearUpload");console.log("🔍 DOM elements check:",{uploadArea:!!o,uploadContent:!!r,clearButton:!!a}),r?(r.innerHTML='\n      <img src="'.concat(t,'" alt="').concat(e.name,'" style="max-width: 100%; max-height: 80px; border-radius: 4px; object-fit: cover;">\n      <div class="upload-text" style="margin-top: 8px; font-size: 12px;">').concat(e.name,"</div>\n    "),console.log("✅ Upload content updated with image preview")):console.error("❌ Upload content element not found!"),o?(o.style.borderColor="#0078D4",o.style.background="#F3F9FF",console.log("✅ Upload area styling updated")):console.error("❌ Upload area element not found!"),a?(a.style.display="flex",console.log("✅ Clear button shown")):console.error("❌ Clear button element not found!");var i=document.getElementById("run"),c=null==i?void 0:i.querySelector(".ms-Button-label");console.log("🔄 Updating generate button:",{generateButton:!!i,generateButtonLabel:!!c,isAuthenticated:!(null!==(n=s)&&void 0!==n&&n.isTokenExpired())}),c?(!s||s.isTokenExpired()?c.textContent="Sign in to Edit Image":c.textContent="Edit Image",console.log("✅ Generate button text updated:",c.textContent)):console.error("❌ Generate button label not found!"),console.log("🎉 Upload section update completed successfully")}function P(e){console.log("Updating UI for authentication status:",e);var t=document.getElementById("logoutButton"),n=document.getElementById("run"),o=document.getElementById("get-more-credits"),r=n.querySelector(".ms-Button-label"),a=document.getElementById("token-display"),s=document.getElementById("account-benefits"),i=document.getElementById("credits-footer");e?(t.style.display="inline-block",n.style.display="flex",n.style.visibility="visible",n.disabled=!1,i&&(i.style.display="flex"),s&&(s.style.display="none"),r.textContent=l?"Edit Image":"Generate",o.disabled=!1):(t.style.display="none",n.style.display="flex",n.style.visibility="visible",n.disabled=!1,i&&(i.style.display="none"),s&&(s.style.display="block"),r.textContent=l?"Sign in to Edit Image":"Sign in to Generate",a&&(a.textContent="",a.classList.remove("premium")),o.disabled=!0)}Office.onReady((function(e){if(e.host===Office.HostType.Word||e.host===Office.HostType.Excel||e.host===Office.HostType.PowerPoint){document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",console.log("🚀 Office add-in initialized"),s=new OfficeAuthManager,console.log("🔐 Auth manager initialized:",s);var t=document.getElementById("run");t&&(t.style.display="flex",t.style.visibility="visible",t.style.opacity="1",console.log("✅ Generate button made visible")),document.getElementById("run").onclick=G,document.getElementById("get-more-credits").onclick=Q,document.getElementById("cancel-generation").onclick=N,document.getElementById("logoutButton").onclick=oe,document.getElementById("uploadArea").onclick=function(e){if(console.log("🖱️ Upload area clicked",e.target),e.target.closest("#clearUpload"))console.log("❌ Clear button clicked, not triggering file input");else{console.log("📁 Triggering file input click");var t=document.getElementById("fileInput");console.log("📁 File input element:",t),t?(t.click(),console.log("✅ File input clicked")):console.error("❌ File input element not found")}},document.getElementById("fileInput").onchange=function(e){console.log("📁 File input changed",e),function(e){console.log("📁 handleFileUpload called",e);var t=e.target.files[0];if(console.log("📁 Selected file:",t),t&&t.type.startsWith("image/")){console.log("✅ Valid image file selected:",t.name,t.type),i=t,c=null,l=!0,console.log("🔄 Starting file reader");var n=new FileReader;n.onload=function(e){var n;console.log("✅ File reader loaded successfully");var o=document.getElementById("uploadArea"),r=o.querySelector(".upload-content"),a=document.getElementById("clearUpload");console.log("🎨 Updating UI elements:",{uploadArea:!!o,uploadContent:!!r,clearButton:!!a}),r?(r.innerHTML='\n          <img src="'.concat(e.target.result,'" alt="').concat(t.name,'" style="max-width: 100%; max-height: 80px; border-radius: 4px; object-fit: cover;">\n          <div class="upload-text" style="margin-top: 8px; font-size: 12px;">').concat(t.name,"</div>\n        "),console.log("✅ Upload content updated with image preview")):console.error("❌ Upload content element not found"),o&&(o.style.borderColor="#0078D4",o.style.background="#F3F9FF",console.log("✅ Upload area styling updated")),a?(a.style.display="flex",console.log("✅ Clear button shown")):console.error("❌ Clear button element not found");var i=document.getElementById("run"),c=null==i?void 0:i.querySelector(".ms-Button-label");console.log("🔄 Updating generate button:",{generateButton:!!i,generateButtonLabel:!!c,isAuthenticated:!(null!==(n=s)&&void 0!==n&&n.isTokenExpired())}),c&&(!s||s.isTokenExpired()?c.textContent="Sign in to Edit Image":c.textContent="Edit Image",console.log("✅ Generate button text updated:",c.textContent)),ne('Image "'.concat(t.name,'" selected for editing!')),console.log("🎉 File upload handling completed successfully")},n.onerror=function(e){console.error("❌ File reader error:",e),te("Failed to read the selected file. Please try again.")},n.readAsDataURL(t)}else{var o;console.error("❌ Invalid file selected:",{file:t,isImage:null==t||null===(o=t.type)||void 0===o?void 0:o.startsWith("image/")}),te("Please select a valid image file.")}}(e)},document.getElementById("getImageFromDoc").onclick=u,document.getElementById("clearUpload").onclick=re,console.log("✅ Event listeners set up"),console.log("🔍 Starting initial token check"),O(),console.log("🔍 Starting initial auth status check"),function(){if(console.log("🔍 Checking authentication status"),s){console.log("🔐 Auth manager available, checking token expiry");var e=!s.isTokenExpired();console.log("🔍 Authentication status:",e);var t=sessionStorage.getItem("user_id"),n=sessionStorage.getItem("access_token");console.log("💾 Session storage check:",{userId:t?"".concat(t.substring(0,10),"..."):"null",accessToken:n?"".concat(n.substring(0,10),"..."):"null"}),P(e)}else console.error("❌ Auth manager not initialized")}();var n=setInterval((function(){console.log("🔄 Periodic token check"),O()}),3e3);window.addEventListener("unload",(function(){n&&clearInterval(n)})),console.log("🎉 Office add-in setup complete")}}));var I=null;function E(){return S.apply(this,arguments)}function S(){return(S=a(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Cancelling authentication process"),s&&s.cancelAuth(),I&&(I=null),L(),ee("Authentication cancelled.","info"),P(!1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return T.apply(this,arguments)}function T(){return(T=a(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Cancelling credits dialog"),L(),ee("Purchase cancelled.","info");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Generating your image...",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.getElementById("loader"),o=n.querySelector(".loader-text"),r=document.getElementById("cancel-generation"),a=document.getElementById("auth-loading-content");o.textContent=e,n.classList.add("active"),r&&(t?(r.querySelector(".ms-Button-label").textContent="Cancel Generation",r.onclick=N):e.includes("Authenticating")?(r.querySelector(".ms-Button-label").textContent="Cancel",r.onclick=E):(e.includes("purchase"),r.querySelector(".ms-Button-label").textContent="Cancel",r.onclick=C)),!t&&e.includes("Authenticating")?(a.style.display="block",o.style.display="none",function(){var e=document.querySelectorAll(".auth-loading-step"),t=document.querySelectorAll(".auth-progress-dot"),n=0;function o(){e.forEach((function(e){return e.classList.remove("active")})),t.forEach((function(e){return e.classList.remove("active")})),n<e.length?(e[n].classList.add("active"),t[n].classList.add("active"),++n>=e.length&&window.authLoadingInterval&&(clearInterval(window.authLoadingInterval),window.authLoadingInterval=null,console.log("Auth animation finished and stopped."))):window.authLoadingInterval&&(clearInterval(window.authLoadingInterval),window.authLoadingInterval=null)}window.authLoadingInterval&&(clearInterval(window.authLoadingInterval),window.authLoadingInterval=null),o(),window.authLoadingInterval=setInterval(o,1e4)}()):(a.style.display="none",o.style.display="block")}function L(){var e=document.getElementById("loader"),t=document.getElementById("auth-loading-content");if(e.classList.remove("active"),t){t.style.display="none";var n=document.querySelectorAll(".auth-loading-step");n.forEach((function(e){return e.classList.remove("active")})),n[0].classList.add("active")}window.authLoadingInterval&&(clearInterval(window.authLoadingInterval),window.authLoadingInterval=null);var o=document.getElementById("cancel-generation");o&&(o.querySelector(".ms-Button-label").textContent="Cancel Generation",o.onclick=N),B=null}var B=null,F=null;function U(e){return _.apply(this,arguments)}function _(){return(_=a(t().mark((function e(n){var o,r,a,s,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n){e.next=3;break}throw new Error("User ID is required");case 3:return console.log("🔍 Checking premium status for user:",n),e.next=6,fetch("https://multiplewords.com/api/account/user_settings/".concat(n));case 6:if((r=e.sent).ok){e.next=10;break}throw console.error("❌ Failed to get premium status:",r.status,r.statusText),new Error("Failed to get premium status: ".concat(r.status));case 10:return e.next=12,r.json();case 12:return a=e.sent,s=null==a||null===(o=a.user_info)||void 0===o?void 0:o.find((function(e){return e.user_id===parseInt(n)})),i=(null==s?void 0:s.is_user_paid)||!1,console.log("✅ Premium status retrieved successfully:",i),e.abrupt("return",i);case 19:throw e.prev=19,e.t0=e.catch(0),console.error("❌ Error checking premium status:",e.t0),e.t0;case 23:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}function O(){return D.apply(this,arguments)}function D(){return(D=a(t().mark((function e(){var n,o,r,a,i,c,u,d,g;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById("token-display"),o=document.getElementById("run"),r=document.getElementById("credits-footer"),console.log("🔍 checkTokens called - DOM elements check:",{tokenDisplay:!!n,generateButton:!!o,creditsFooter:!!r,tokenDisplayElement:n,currentTokenText:null==n?void 0:n.textContent}),e.prev=4,s&&!s.isTokenExpired()){e.next=11;break}return console.log("User is not authenticated. Hiding credits footer."),r&&(r.style.display="none",console.log("✅ Credits footer hidden for non-authenticated user")),n&&(n.textContent="",n.classList.remove("premium")),o&&(a=o.querySelector(".ms-Button-label"),o.disabled=!1,o.classList.remove("disabled"),a.textContent=l?"Sign in to Edit Image":"Sign in to Generate"),e.abrupt("return");case 11:if(r&&(r.style.display="flex",console.log("✅ Credits footer shown for authenticated user")),i=s.getUserId()){e.next=18;break}return console.warn("Authenticated user has no ID available. Check auth flow."),n&&(n.textContent="Error",n.classList.remove("premium")),o&&(o.disabled=!0,o.classList.add("disabled"),o.querySelector(".ms-Button-label").textContent="Authentication Error"),e.abrupt("return");case 18:return console.log("Checking tokens for authenticated user:",i),e.next=21,U(i);case 21:return c=e.sent,e.next=24,fetch("https://shorts.multiplewords.com/api/tokens_left/get/".concat(i),{method:"GET"});case 24:if(u=e.sent,console.log("Token check API response status:",u.status),u.ok){e.next=28;break}throw new Error("HTTP error! status: ".concat(u.status));case 28:return e.next=30,u.json();case 30:d=e.sent,console.log("Token check full response:",d),console.log("Credits object:",d.credits),console.log("Is premium user?",c),c?(console.log("Handling premium user display"),n?(console.log("🔄 Setting token display to ∞ for premium user"),n.textContent="∞",n.classList.add("premium"),console.log("✅ Token display updated:",{textContent:n.textContent,classList:n.classList.toString(),style:n.style.cssText})):console.error("❌ tokenDisplay element not found!"),o&&(o.disabled=!1,o.classList.remove("disabled"),o.querySelector(".ms-Button-label").textContent="Generate",console.log("✅ Generate button updated for premium user"))):(g=d.credits&&void 0!==d.credits.videos?d.credits.videos:0,console.log("Regular user token count:",g),n&&(n.textContent=g,n.classList.remove("premium"),console.log("✅ Token display updated for regular user:",g)),g<=0?(console.log("No tokens available, disabling generate button"),o&&(o.disabled=!0,o.classList.add("disabled"),o.querySelector(".ms-Button-label").textContent="No Credits Available")):(console.log("Tokens available, enabling generate button"),o&&(o.disabled=!1,o.classList.remove("disabled"),o.querySelector(".ms-Button-label").textContent="Generate"))),e.next=42;break;case 37:e.prev=37,e.t0=e.catch(4),console.error("Detailed error in checkTokens:",{error:e.t0,message:e.t0.message,stack:e.t0.stack}),n&&(n.textContent="Error",n.classList.remove("premium")),o&&(o.disabled=!0,o.classList.add("disabled"),o.querySelector(".ms-Button-label").textContent="Error Checking Credits");case 42:case"end":return e.stop()}}),e,null,[[4,37]])})))).apply(this,arguments)}function N(){return j.apply(this,arguments)}function j(){return(j=a(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B&&(B.abort(),B=null,L(),ee("Image generation cancelled.","success"),document.getElementById("run").disabled=!1);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(){return q.apply(this,arguments)}function q(){return(q=a(t().mark((function e(){var n,o,r,a,u,d;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!s.isTokenExpired()){e.next=13;break}return A("Authenticating...",!1),e.next=5,s.authenticate();case 5:if((n=e.sent).success){e.next=10;break}return L(),te("Authentication failed: ".concat(n.error)),e.abrupt("return");case 10:L(),ne("Authentication successful!"),P(!0);case 13:if(o=s.getUserId()){e.next=17;break}return te("User ID not available. Please try logging in again."),e.abrupt("return");case 17:return e.next=19,U(o);case 19:if(r=e.sent,a=document.querySelector(".input-field").value.trim()){e.next=24;break}return te(l?"Please enter instructions for editing the image.":"Please enter a prompt for the image generation."),e.abrupt("return");case 24:if(!l||!i&&!c){e.next=29;break}return e.next=27,W(o,r,a);case 27:e.next=35;break;case 29:if((u=document.getElementById("image-purpose-select")).value){e.next=33;break}return te("Please select an image purpose."),e.abrupt("return");case 33:return e.next=35,R(o,r,a,u.value);case 35:e.next=46;break;case 37:e.prev=37,e.t0=e.catch(0),console.error("Detailed error in generateImage:",{error:e.t0,message:e.t0.message,stack:e.t0.stack}),L(),d="An error occurred while processing the image.","AbortError"===e.t0.name?d="Image processing was cancelled.":e.t0.message.includes("HTTP error")?d="Failed to connect to the image processing service. Please try again later.":"TypeError"===e.t0.name&&e.t0.message.includes("fetch")&&(d="Network error. Please check your internet connection."),te(d),document.getElementById("run").disabled=!1;case 46:case"end":return e.stop()}}),e,null,[[0,37]])})))).apply(this,arguments)}function W(e,t,n){return H.apply(this,arguments)}function H(){return(H=a(t().mark((function e(n,o,r){var a,s,l,u,d,g,p,m,f;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Starting image editing process"),console.log("Checking tokens before editing for user:",n),e.next=4,fetch("https://shorts.multiplewords.com/api/tokens_left/get/".concat(n),{method:"GET"});case 4:if(s=e.sent,console.log("Pre-editing token check status:",s.status),s.ok){e.next=8;break}throw new Error("HTTP error! status: ".concat(s.status));case 8:return e.next=10,s.json();case 10:if(l=e.sent,console.log("Pre-editing token check response:",l),console.log("User premium status:",o),console.log("Available video tokens:",null===(a=l.credits)||void 0===a?void 0:a.videos),o||l.credits&&l.credits.videos&&!(l.credits.videos<1)){e.next=18;break}return console.log("Token check failed:",{hasCredits:!!l.credits,videoTokens:null===(u=l.credits)||void 0===u?void 0:u.videos}),te("Insufficient tokens. Please get more credits to continue."),e.abrupt("return");case 18:if(A("Editing your image..."),(d=document.getElementById("run")).disabled=!0,B=new AbortController,(g=new FormData).append("prompt",r),g.append("user_id",n),g.append("isPro",o?"1":"0"),!i){e.next=31;break}g.append("file",i),console.log("Using uploaded file for editing:",i.name),e.next=40;break;case 31:if(!c){e.next=39;break}return e.next=34,z(c);case 34:p=e.sent,g.append("file",p,"captured_image.png"),console.log("Using captured image data for editing"),e.next=40;break;case 39:throw new Error("No image available for editing");case 40:return console.log("Sending image editing request:",{isPro:o?"1":"0",user_id:n,prompt:r,hasFile:!(!i&&!c),endpoint:"https://shorts.multiplewords.com/mwvideos/api/edit_image_from_text"}),e.next=43,fetch("https://shorts.multiplewords.com/mwvideos/api/edit_image_from_text",{method:"POST",body:g,signal:B.signal});case 43:if(m=e.sent,console.log("Image editing response status:",m.status),m.ok){e.next=47;break}throw new Error("HTTP error! status: ".concat(m.status));case 47:return e.next=49,m.json();case 49:if(f=e.sent,console.log("Image editing full response:",f),1!==f.status||!f.edited_image_url){e.next=61;break}return console.log("Successfully received edited image URL:",f.edited_image_url),A("Inserting edited image into document..."),e.next=56,$(f.edited_image_url);case 56:L(),ne("Image edited and inserted successfully!"),o||(console.log("Updating tokens after editing for non-premium user"),O()),e.next=65;break;case 61:L(),console.error("Invalid API response:",{status:f.status,hasEditedImageUrl:!!f.edited_image_url}),te(f.msg||f.message||"Failed to edit image. Please try again.");case 65:d.disabled=!1;case 66:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t,n,o){return M.apply(this,arguments)}function M(){return(M=a(t().mark((function e(n,o,r,a){var s,i,c,l,u,d,g,p,m;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Starting image generation process"),console.log("Checking tokens before generation for user:",n),e.next=4,fetch("https://shorts.multiplewords.com/api/tokens_left/get/".concat(n),{method:"GET"});case 4:if(i=e.sent,console.log("Pre-generation token check status:",i.status),i.ok){e.next=8;break}throw new Error("HTTP error! status: ".concat(i.status));case 8:return e.next=10,i.json();case 10:if(c=e.sent,console.log("Pre-generation token check response:",c),console.log("User premium status:",o),console.log("Available video tokens:",null===(s=c.credits)||void 0===s?void 0:s.videos),o||c.credits&&c.credits.videos&&!(c.credits.videos<1)){e.next=18;break}return console.log("Token check failed:",{hasCredits:!!c.credits,videoTokens:null===(l=c.credits)||void 0===l?void 0:l.videos}),te("Insufficient tokens. Please get more credits to continue."),e.abrupt("return");case 18:return A("Generating your image..."),(u=document.getElementById("run")).disabled=!0,B=new AbortController,(d=new FormData).append("isPro",o?"1":"0"),d.append("user_id",n),d.append("prompt",r),d.append("purpose",a),console.log("Sending image generation request:",{isPro:o?"1":"0",user_id:n,prompt:r,purpose:a,endpoint:"https://shorts.multiplewords.com/mwvideos/api/generate_image"}),e.next=30,fetch("https://shorts.multiplewords.com/mwvideos/api/generate_image",{method:"POST",body:d,signal:B.signal});case 30:if(g=e.sent,console.log("Image generation response status:",g.status),g.ok){e.next=34;break}throw new Error("HTTP error! status: ".concat(g.status));case 34:return e.next=36,g.json();case 36:if(p=e.sent,console.log("Image generation full response:",p),1!==p.status||!p.generated_image||!p.generated_image.image_url){e.next=48;break}return console.log("Successfully received image URL:",p.generated_image.image_url),A("Inserting image into document..."),e.next=43,$(p.generated_image.image_url);case 43:L(),ne("Image generated and inserted successfully!"),o||(console.log("Updating tokens after generation for non-premium user"),O()),e.next=52;break;case 48:L(),console.error("Invalid API response:",{status:p.status,hasGeneratedImage:!!p.generated_image,hasImageUrl:null===(m=p.generated_image)||void 0===m?void 0:m.image_url}),te(p.msg||p.message||"Failed to generate image. Please try again.");case 52:u.disabled=!1;case 53:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return K.apply(this,arguments)}function K(){return(K=a(t().mark((function e(n){var o,r,a,s,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"string"!=typeof n){e.next=8;break}for(o=n.includes(",")?n.split(",")[1]:n,r=atob(o),a=new Array(r.length),s=0;s<r.length;s++)a[s]=r.charCodeAt(s);return i=new Uint8Array(a),e.abrupt("return",new Blob([i],{type:"image/png"}));case 8:if(!(n instanceof Blob)){e.next=10;break}return e.abrupt("return",n);case 10:if(!(n instanceof ArrayBuffer)){e.next=12;break}return e.abrupt("return",new Blob([n],{type:"image/png"}));case 12:throw new Error("Unsupported image data format");case 15:throw e.prev=15,e.t0=e.catch(0),console.error("Error converting image data to blob:",e.t0),new Error("Failed to process captured image data");case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function $(e){return V.apply(this,arguments)}function V(){return V=a(t().mark((function e(n){var o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y(n);case 3:return o=e.sent,e.abrupt("return",new Promise((function(e,n){Office.onReady((function(r){try{switch(r.host){case Office.HostType.Word:Word.run(function(){var n=a(t().mark((function n(r){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.document.getSelection().insertInlinePictureFromBase64(o,"Replace"),t.next=4,r.sync();case 4:e();case 5:case"end":return t.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());break;case Office.HostType.Excel:Excel.run(function(){var n=a(t().mark((function n(r){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r.workbook.getSelectedRange(),(s=a.worksheet.shapes.addImage(o)).width=300,s.height=300,t.next=6,r.sync();case 6:e();case 7:case"end":return t.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());break;case Office.HostType.PowerPoint:Office.context.document.setSelectedDataAsync(o,{coercionType:Office.CoercionType.Image,imageLeft:100,imageTop:100,imageWidth:300,imageHeight:300},(function(t){t.status===Office.AsyncResultStatus.Succeeded?(console.log("Image inserted successfully in PowerPoint"),e()):(console.error("Failed to insert image in PowerPoint:",t.error.message),n(new Error(t.error.message)))}));break;default:n(new Error("Unsupported Office application"))}}catch(e){n(e)}}))})));case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Error inserting image:",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),V.apply(this,arguments)}function Y(e){return J.apply(this,arguments)}function J(){return(J=a(t().mark((function e(n){var o,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Fetching image from URL:",n),e.next=4,fetch(n);case 4:if((o=e.sent).ok){e.next=7;break}throw new Error("Failed to fetch image: ".concat(o.status," ").concat(o.statusText));case 7:return e.next=9,o.blob();case 9:return r=e.sent,e.abrupt("return",new Promise((function(e,t){var n=new FileReader;n.onloadend=function(){try{var o=n.result.split(",")[1];if(!o)return void t(new Error("Failed to get valid base64 data from image"));console.log("Image successfully converted to base64"),e(o)}catch(e){console.error("Error processing base64 data:",e),t(e)}},n.onerror=function(e){console.error("Error converting image to base64:",e),t(e)},n.readAsDataURL(r)})));case 13:throw e.prev=13,e.t0=e.catch(0),console.error("Error in fetchImageAsBase64:",e.t0),new Error("Failed to process the generated image: "+e.t0.message);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function Q(){return X.apply(this,arguments)}function X(){return(X=a(t().mark((function e(){var o,r,a,i,c,l,u,d,g;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("💳 getMoreCredits function called"),e.prev=1,r=s.getUserId()){e.next=7;break}return console.log("❌ No user ID available"),te("Authentication required. Please sign in first."),e.abrupt("return");case 7:return console.log("👤 User ID:",r),console.log("🔄 Fetching initial token count and premium status..."),e.next=11,Promise.all([fetch("https://shorts.multiplewords.com/api/tokens_left/get/".concat(r)),U(r)]);case 11:if(a=e.sent,i=n(a,2),c=i[0],l=i[1],c.ok){e.next=17;break}throw new Error("Failed to get initial token count");case 17:return e.next=19,c.json();case 19:return u=e.sent,d=(null===(o=u.credits)||void 0===o?void 0:o.videos)||0,console.log("📊 Initial state captured:",{tokens:d,isPremium:l}),console.log("🔄 Showing initial loader"),A("Processing your purchase...",!1),e.prev=24,console.log("🌐 Opening credits dialog..."),e.next=28,s.openCreditsDialog(r);case 28:g=e.sent,console.log("💳 Credits dialog result:",g),g.success?(console.log("✅ Dialog indicates success, starting purchase check..."),Z(r,d,l)):(console.log("❌ Dialog indicates no purchase or cancellation"),L(),ee("Purchase cancelled or completed.","info")),e.next=39;break;case 33:return e.prev=33,e.t0=e.catch(24),console.error("❌ Error opening credits dialog:",e.t0),te("Failed to open credits purchase page. Please try again."),L(),e.abrupt("return");case 39:e.next=46;break;case 41:e.prev=41,e.t1=e.catch(1),console.error("❌ Error in getMoreCredits:",e.t1),te("An error occurred while processing your request. Please try again."),L();case 46:case"end":return e.stop()}}),e,null,[[1,41],[24,33]])})))).apply(this,arguments)}function Z(e,o,r){console.log("🔄 startPurchaseCheck called with:",{userId:e,initialTokens:o,initialPremiumStatus:r}),F&&(console.log("🗑️ Clearing existing purchase check interval:",F),clearInterval(F),F=null);var s=!1,i=0;console.log("🔄 Showing loader for purchase check"),A("Checking for purchase completion...",!1),console.log("⏰ Starting purchase check interval (every 3 seconds)"),F=setInterval(a(t().mark((function a(){var c,l,u,d,g,p,m;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i++,console.log("🔍 Purchase check #".concat(i," triggered, hasUpdated:"),s),console.log("🔍 Current interval ID:",F),!s){t.next=6;break}return console.log("⏭️ Skipping check - already updated"),t.abrupt("return");case 6:return t.prev=6,console.log("🌐 Fetching current token count and premium status..."),t.next=10,Promise.all([fetch("https://shorts.multiplewords.com/api/tokens_left/get/".concat(e)),U(e)]);case 10:if(l=t.sent,u=n(l,2),d=u[0],g=u[1],d.ok){t.next=17;break}throw console.error("❌ Token response not OK:",d.status),new Error("Failed to get current token count");case 17:return t.next=19,d.json();case 19:if(p=t.sent,m=(null===(c=p.credits)||void 0===c?void 0:c.videos)||0,console.log("📊 Purchase status check results:",{checkNumber:i,initialTokens:o,currentTokens:m,initialPremiumStatus:r,newPremiumStatus:g,tokenDiff:m-o,tokenIncreased:m>o,becamePremium:!r&&g,shouldStop:m>o||!r&&g}),!(m>o||!r&&g)){t.next=37;break}return console.log("🎉 Purchase detected! Stopping check and hiding loader"),console.log("🛑 Setting hasUpdated to true"),s=!0,console.log("🗑️ Clearing interval:",F),clearInterval(F),F=null,console.log("🔄 Hiding loader"),L(),g&&!r?(console.log("✨ User became premium"),ne("Premium status activated successfully!")):m>o&&(console.log("🪙 Tokens increased from",o,"to",m),ne("Credits added successfully! (".concat(m-o," tokens added)"))),console.log("🔄 Updating token display after purchase"),t.next=35,O();case 35:t.next=39;break;case 37:console.log("⏳ No purchase detected yet, continuing to check..."),console.log("🔍 Will check again in 3 seconds...");case 39:t.next=44;break;case 41:t.prev=41,t.t0=t.catch(6),console.error("❌ Error checking purchase status:",t.t0);case 44:case"end":return t.stop()}}),a,null,[[6,41]])}))),3e3),console.log("✅ Purchase check interval created with ID:",F),console.log("⏰ Setting 5-minute timeout for purchase check"),setTimeout((function(){console.log("⏰ Purchase check timeout reached"),F&&!s?(console.log("⏰ Timeout: Clearing interval and hiding loader"),clearInterval(F),F=null,L(),ee("Purchase status check timed out. Please refresh if you completed the purchase.","error")):console.log("⏰ Timeout: But purchase was already detected or interval was cleared")}),3e5)}function ee(e,t){var n=document.getElementById("notification");n.textContent=e,n.className="notification ".concat(t),n.style.display="block",setTimeout((function(){n.style.display="none"}),3e3)}function te(e){ee(e,"error")}function ne(e){ee(e,"success")}function oe(){console.log("Logout button clicked"),s.logout(),P(!1),ne("Logged out successfully")}function re(){i=null,c=null,l=!1;var e=document.getElementById("uploadArea"),t=e.querySelector(".upload-content"),n=document.getElementById("clearUpload");t.innerHTML='\n    <div class="upload-icon">📁</div>\n    <div class="upload-text">Click to upload an image</div>\n  ',e.style.borderColor="#C8C6C4",e.style.background="#FAFAFA",n.style.display="none",document.getElementById("fileInput").value="";var o=document.getElementById("run").querySelector(".ms-Button-label");!s||s.isTokenExpired()?o.textContent="Sign in to Generate":o.textContent="Generate",ne("Switched back to image generation mode!")}window.debugStopPurchaseCheck=function(){return console.log("🛑 Manual debug stop of purchase check called"),console.log("🔍 Current purchaseCheckInterval state:",F),F?(console.log("🗑️ Clearing purchase check interval manually"),clearInterval(F),F=null,L(),ne("Purchase check stopped manually (debug function)"),!0):(console.log("❌ No active purchase check interval found"),ee("No active purchase check found","info"),!1)},window.debugPurchaseCheckState=function(){return console.log("🔍 Purchase check debug state:",{purchaseCheckInterval:F,intervalIsActive:!!F,intervalId:F}),{active:!!F,intervalId:F}},window.addEventListener("unload",(function(){F&&(clearInterval(F),F=null)}))}(),function(){"use strict";new URL(n(58394),n.b),new URL(n(34799),n.b)}()}();
//# sourceMappingURL=taskpane.js.map